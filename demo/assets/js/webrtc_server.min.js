var room=location.search&&location.search.split("?")[1],mediaOptions={audio:!0,video:!1},webrtc=new SimpleWebRTC({localVideoEl:"localVideo",remoteVideosEl:"",autoRequestMedia:!0,debug:!1,detectSpeakingEvents:!0,autoAdjustMic:!1,media:mediaOptions});webrtc.joinRoom("auto1");webrtc.on("readyToCall",function(){webrtc.joinRoom("auto1")});function showVolume(a,b){a&&(a.style.height=-45>b?"0px":-20<b?"100%":""+Math.floor(100*(b+100)/25-220)+"%")}
webrtc.on("channelMessage",function(a,b,c){"volume"==c.type&&showVolume(document.getElementById("volume_"+a.id),c.volume)});
webrtc.on("videoAdded",function(a,b){console.log("video added",b);var c=document.getElementById("remotes");if(c){var d=document.createElement("div");d.className="videoContainer";d.id="container_"+webrtc.getDomId(b);d.appendChild(a);var e=document.createElement("div");e.id="volume_"+b.id;e.className="volume_bar";a.onclick=function(){a.style.width=a.videoWidth+"px";a.style.height=a.videoHeight+"px"};d.appendChild(e);c.appendChild(d)}});
webrtc.on("videoRemoved",function(a,b){console.log("video removed ",b);var c=document.getElementById("remotes"),d=document.getElementById("container_"+webrtc.getDomId(b));c&&d&&c.removeChild(d)});webrtc.on("volumeChange",function(a,b){showVolume(document.getElementById("localVolume"),a)});function setRoom(a){$("form").remove();$("h1").text(a);$("#subTitle").text("Link to join: "+location.href);$("body").addClass("active")}
room?setRoom(room):$("form").submit(function(){var a=$("#sessionInput").val().toLowerCase().replace(/\s/g,"-").replace(/[^A-Za-z0-9_\-]/g,"");webrtc.createRoom(a,function(a,c){console.log(" create room cb",arguments);var d=location.pathname+"?"+c;a?console.log(a):(history.replaceState({foo:"bar"},null,d),setRoom(c))});return!1});var button=$("#screenShareButton"),setButton=function(a){button.text(a?"share screen":"stop sharing")};webrtc.on("localScreenStopped",function(){setButton(!0)});setButton(!0);
button.click(function(){webrtc.getLocalScreen()?(webrtc.stopScreenShare(),setButton(!0)):webrtc.shareScreen(function(a){a?setButton(!0):setButton(!1)})});
